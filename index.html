<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Interview Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .intro-section {
            text-align: left;
            color: #333;
            margin-bottom: 40px;
        }
        
        .intro-section h1 {
            color: #34495e;
            margin-bottom: 25px;
            font-size: 32px;
            text-align: center;
            font-weight: bold;
        }
        
        .intro-section p {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .tips {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
            padding: 15px;
            background-color: #e8f4f8;
            border-radius: 8px;
            border-left: 4px solid #34495e;
        }
        
        .widget-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            position: relative;
        }
        
        /* Hide the default VAPI widget visually but keep it functional */
        vapi-widget {
            opacity: 0 !important;
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            width: 144px !important;
            height: 144px !important;
            z-index: 999 !important;
            pointer-events: auto !important; /* Keep it clickable */
        }
        
        /* Create our own custom 2-inch pulsing button */
        .custom-interview-button {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 144px; /* 2 inches */
            height: 144px; /* 2 inches */
            border-radius: 50%;
            background-color: #34495e;
            color: white;
            border: none;
            cursor: pointer;
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            z-index: 1000;
            animation: pulse 2s infinite ease-in-out;
            transition: transform 0.3s ease;
            user-select: none;
        }
        
        .custom-interview-button:hover {
            transform: translate(-50%, -50%) scale(1.05);
        }
        
        /* Our beautiful pulsing animation */
        @keyframes pulse {
            0% {
                background-color: #34495e;
                box-shadow: 0 0 10px rgba(52, 73, 94, 0.2);
                opacity: 0.8;
            }
            50% {
                background-color: #5dade2;
                box-shadow: 0 0 40px rgba(93, 173, 226, 0.9), 
                           0 0 60px rgba(93, 173, 226, 0.6),
                           0 0 80px rgba(93, 173, 226, 0.3);
                opacity: 1;
            }
            100% {
                background-color: #34495e;
                box-shadow: 0 0 10px rgba(52, 73, 94, 0.2);
                opacity: 0.8;
            }
        }
        
        /* Button states */
        .custom-interview-button.connecting {
            background-color: #f39c12;
            animation: connecting-pulse 1s infinite ease-in-out;
        }
        
        .custom-interview-button.active {
            background-color: #e74c3c;
            animation: active-pulse 1.5s infinite ease-in-out;
        }
        
        @keyframes connecting-pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        @keyframes active-pulse {
            0%, 100% { 
                background-color: #e74c3c;
                box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
            }
            50% { 
                background-color: #c0392b;
                box-shadow: 0 0 30px rgba(231, 76, 60, 0.9);
            }
        }
        
        /* Remove custom overlay that might interfere */
        
        /* Status messages */
        .status-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 25px;
            font-size: 14px;
            z-index: 1002;
            display: none;
            text-align: center;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .intro-section h1 {
                font-size: 28px;
            }
            
            .intro-section p {
                font-size: 16px;
            }
            
            .pulse-overlay {
                width: 150px;
                height: 150px;
                font-size: 16px;
            }
            
            vapi-widget {
                width: 150px !important;
                height: 150px !important;
            }
        }
        
        /* Hide widget initially until it loads */
        vapi-widget {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        vapi-widget.loaded {
            opacity: 1;
        }
        
        /* Add some basic styling after widget loads */
        vapi-widget.loaded {
            animation: fadeInPulse 1s ease-in-out;
        }
        
        @keyframes fadeInPulse {
            0% { 
                opacity: 0; 
                transform: scale(0.9); 
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1.05); 
            }
            100% { 
                opacity: 1; 
                transform: scale(1); 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="intro-section">
            <h1>Ready for Your AI Interview?</h1>
            <p>
                Before you begin, please find a <strong>quiet, private location</strong> with good internet connection. Make sure you're in a well-lit space where you can speak clearly without interruptions.
            </p>
            <p>
                The AI assistant will guide you through the interview process. Speak naturally and take your time to think before answering. If you need clarification on any question, don't hesitate to ask.
            </p>
            <div class="tips">
                <strong>üìù Tips for Success:</strong><br>
                ‚Ä¢ Use headphones or earbuds for better audio quality<br>
                ‚Ä¢ Close other applications to ensure stable connection<br>
                ‚Ä¢ Have your resume or relevant documents nearby if needed<br>
                ‚Ä¢ Speak clearly and at a normal pace
            </div>
        </div>
        
        <div class="widget-area">
            <!-- Hidden VAPI widget -->
            <vapi-widget 
                assistant-id="35c7f5f0-a44c-4172-85da-1c05cc5e55e7" 
                public-key="1f80cbcd-97fc-45ad-ba54-5eff014c5f4e"
                mode="voice"
                theme="dark"
            ></vapi-widget>
            
            <!-- Our custom pulsing button -->
            <button class="custom-interview-button" id="customButton" onclick="toggleInterview()">
                Click to talk
            </button>
        </div>
    </div>
    
    <div class="status-message" id="statusMessage"></div>
    
    <script src="https://unpkg.com/@vapi-ai/client-sdk-react/dist/embed/widget.umd.js" async type="text/javascript"></script>
    
    <script>
        // Combine version 29 custom button with version 28 working logic
        console.log('AI Interview page loaded');
        let isCallActive = false;
        
        function showStatus(message, duration = 3000) {
            const statusEl = document.getElementById('statusMessage');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.display = 'block';
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, duration);
            }
        }
        
        function updateButton(text, state = 'default') {
            const button = document.getElementById('customButton');
            if (button) {
                button.textContent = text;
                button.className = 'custom-interview-button';
                if (state !== 'default') {
                    button.classList.add(state);
                }
            }
        }
        
        function forceWidgetPosition() {
            const widget = document.querySelector('vapi-widget');
            if (widget) {
                // Keep widget invisible but in correct position for functionality
                widget.style.position = 'fixed';
                widget.style.top = '50%';
                widget.style.left = '50%';
                widget.style.transform = 'translate(-50%, -50%)';
                widget.style.width = '144px';
                widget.style.height = '144px';
                widget.style.opacity = '0';
                widget.style.zIndex = '999';
                widget.style.pointerEvents = 'auto';
                return true;
            }
            return false;
        }
        
        function toggleInterview() {
            console.log('Custom button clicked, triggering real widget');
            const widget = document.querySelector('vapi-widget');
            
            if (!widget) {
                showStatus('Interview system not ready. Please refresh the page.');
                return;
            }
            
            // Directly click the real VAPI widget
            try {
                widget.click();
                console.log('‚úÖ Real widget clicked');
                
                if (!isCallActive) {
                    updateButton('Connecting...', 'connecting');
                    showStatus('Starting your interview...');
                } else {
                    updateButton('Ending...', 'connecting');
                    showStatus('Ending interview...');
                }
                
            } catch (error) {
                console.error('Error clicking widget:', error);
                showStatus('Error starting interview. Please try again.');
            }
        }
        
        function setupWidgetMonitoring() {
            const widget = document.querySelector('vapi-widget');
            if (widget) {
                // Monitor widget state changes (from version 28 approach)
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'attributes' || mutation.type === 'childList') {
                            // Check various indicators that call is active
                            const hasActiveClass = widget.classList.contains('active');
                            const hasActiveData = widget.getAttribute('data-state') === 'active';
                            const hasActiveButton = widget.querySelector('[data-testid*="end"], [data-testid*="stop"], button[aria-label*="end"], button[aria-label*="stop"]');
                            
                            const shouldBeActive = hasActiveClass || hasActiveData || hasActiveButton;
                            
                            if (shouldBeActive && !isCallActive) {
                                isCallActive = true;
                                updateButton('End Interview', 'active');
                                showStatus('Interview started - speak clearly!');
                                console.log('‚úÖ Call detected as active');
                            } else if (!shouldBeActive && isCallActive) {
                                isCallActive = false;
                                updateButton('Click to talk');
                                showStatus('Interview ended');
                                console.log('‚úÖ Call detected as ended');
                            }
                        }
                    });
                });
                
                observer.observe(widget, {
                    attributes: true,
                    attributeFilter: ['class', 'data-state', 'aria-label'],
                    childList: true,
                    subtree: true
                });
                
                // Also monitor for text changes in widget
                setInterval(() => {
                    const widgetText = widget.textContent || '';
                    const isActive = widgetText.toLowerCase().includes('end') || 
                                   widgetText.toLowerCase().includes('stop') ||
                                   widgetText.toLowerCase().includes('hang up');
                    
                    if (isActive && !isCallActive) {
                        isCallActive = true;
                        updateButton('End Interview', 'active');
                        showStatus('Interview started - speak clearly!');
                    } else if (!isActive && isCallActive && !widgetText.toLowerCase().includes('start')) {
                        isCallActive = false;
                        updateButton('Click to talk');
                        showStatus('Interview ended');
                    }
                }, 1000);
                
                console.log('‚úÖ Widget monitoring setup complete');
            }
        }
        
        // Initialize (combining version 28 and 29 approaches)
        setTimeout(() => {
            const widget = document.querySelector('vapi-widget');
            if (widget) {
                console.log('‚úÖ VAPI widget found');
                
                // Position the widget correctly (version 28 logic)
                forceWidgetPosition();
                
                // Set up monitoring (version 28 logic)
                setupWidgetMonitoring();
                
                // Continue monitoring position
                setInterval(forceWidgetPosition, 1000);
                
                showStatus('Ready for your interview!', 2000);
                
            } else {
                console.log('‚ùå Widget not found, retrying...');
                setTimeout(() => {
                    const retryWidget = document.querySelector('vapi-widget');
                    if (retryWidget) {
                        console.log('‚úÖ VAPI widget found on retry');
                        forceWidgetPosition();
                        setupWidgetMonitoring();
                        setInterval(forceWidgetPosition, 1000);
                        showStatus('Ready for your interview!', 2000);
                    } else {
                        console.log('‚ùå Widget failed to load');
                        showStatus('Please refresh the page if the interview button doesn\'t appear', 5000);
                    }
                }, 3000);
            }
        }, 2000);
    </script>
</body>
</html>
